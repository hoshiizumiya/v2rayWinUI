<?xml version="1.0" encoding="utf-8" ?>
<Flyout
    x:Class="v2rayWinUI.Views.Tray.TrayMenuFlyout"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cw="using:CommunityToolkit.WinUI"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:v2rayWinUI.Views.Tray"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxm="using:Microsoft.UI.Xaml.Media"
    ShouldConstrainToRootBounds="False"
    mc:Ignorable="d">
    <Flyout.SystemBackdrop>
        <muxm:DesktopAcrylicBackdrop />
    </Flyout.SystemBackdrop>

    <Flyout.FlyoutPresenterStyle>
        <Style BasedOn="{StaticResource DefaultFlyoutPresenterStyle}" TargetType="FlyoutPresenter">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>
    </Flyout.FlyoutPresenterStyle>

    <Grid x:Name="Root" Background="Transparent">
        <Grid.Resources>
            <Style x:Key="NotifyIconContextMenuFlyoutItemStyle" TargetType="MenuFlyoutItem">
                <Setter Property="AllowFocusOnInteraction" Value="True" />
                <Setter Property="Background" Value="{ThemeResource MenuFlyoutItemBackground}" />
                <Setter Property="BorderBrush" Value="{ThemeResource MenuFlyoutItemBackgroundBrush}" />
                <Setter Property="BorderThickness" Value="{ThemeResource MenuFlyoutItemBorderThickness}" />
                <Setter Property="CornerRadius" Value="{ThemeResource ControlCornerRadius}" />
                <Setter Property="FontSize" Value="{ThemeResource ControlContentThemeFontSize}" />
                <Setter Property="Foreground" Value="{ThemeResource MenuFlyoutItemForeground}" />
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                <Setter Property="KeyboardAcceleratorPlacementMode" Value="Hidden" />
                <Setter Property="Padding" Value="{StaticResource MenuFlyoutItemThemePadding}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="MenuFlyoutItem">
                            <Grid
                                x:Name="LayoutRoot"
                                Margin="{StaticResource MenuFlyoutItemMargin}"
                                Padding="{TemplateBinding Padding}"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="{TemplateBinding CornerRadius}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Viewbox
                                    x:Name="IconRoot"
                                    Width="16"
                                    Height="16"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center">
                                    <ContentPresenter x:Name="IconContent" Content="{TemplateBinding Icon}" />
                                </Viewbox>
                                <TextBlock
                                    x:Name="TextBlock"
                                    Grid.Column="1"
                                    Margin="8,0,0,0"
                                    HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                    Foreground="{TemplateBinding Foreground}"
                                    Text="{TemplateBinding Text}"
                                    TextTrimming="{ThemeResource MenuFlyoutItemTextTrimming}" />
                                <TextBlock
                                    x:Name="KeyboardAcceleratorTextBlock"
                                    Grid.Column="2"
                                    MinWidth="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=TemplateSettings.KeyboardAcceleratorTextMinWidth}"
                                    Margin="24,4,0,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                    AutomationProperties.AccessibilityView="Raw"
                                    Foreground="{ThemeResource MenuFlyoutItemKeyboardAcceleratorTextForeground}"
                                    Style="{ThemeResource CaptionTextBlockStyle}"
                                    Text="{TemplateBinding KeyboardAcceleratorTextOverride}"
                                    TextAlignment="Right"
                                    Visibility="Collapsed" />
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal" />
                                        <VisualState x:Name="PointerOver">
                                            <VisualState.Setters>
                                                <Setter Target="LayoutRoot.Background" Value="{ThemeResource MenuFlyoutItemBackgroundPointerOver}" />
                                                <Setter Target="TextBlock.Foreground" Value="{ThemeResource MenuFlyoutItemForegroundPointerOver}" />
                                                <Setter Target="IconContent.Foreground" Value="{ThemeResource MenuFlyoutItemForegroundPointerOver}" />
                                                <Setter Target="KeyboardAcceleratorTextBlock.Foreground" Value="{ThemeResource MenuFlyoutItemKeyboardAcceleratorTextForegroundPointerOver}" />
                                            </VisualState.Setters>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <VisualState.Setters>
                                                <Setter Target="LayoutRoot.Background" Value="{ThemeResource MenuFlyoutItemBackgroundPressed}" />
                                                <Setter Target="TextBlock.Foreground" Value="{ThemeResource MenuFlyoutItemForegroundPressed}" />
                                                <Setter Target="IconContent.Foreground" Value="{ThemeResource MenuFlyoutItemForegroundPressed}" />
                                                <Setter Target="KeyboardAcceleratorTextBlock.Foreground" Value="{ThemeResource MenuFlyoutItemKeyboardAcceleratorTextForegroundPressed}" />
                                            </VisualState.Setters>
                                        </VisualState>
                                        <VisualState x:Name="Disabled">
                                            <VisualState.Setters>
                                                <Setter Target="LayoutRoot.Background" Value="{ThemeResource MenuFlyoutItemBackgroundDisabled}" />
                                                <Setter Target="TextBlock.Foreground" Value="{ThemeResource MenuFlyoutItemForegroundDisabled}" />
                                                <Setter Target="IconContent.Foreground" Value="{ThemeResource MenuFlyoutItemForegroundDisabled}" />
                                                <Setter Target="KeyboardAcceleratorTextBlock.Foreground" Value="{ThemeResource MenuFlyoutItemKeyboardAcceleratorTextForegroundDisabled}" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                    <VisualStateGroup x:Name="CheckPlaceholderStates">
                                        <VisualState x:Name="NoPlaceholder" />
                                        <VisualState x:Name="CheckPlaceholder">
                                            <VisualState.Setters>
                                                <Setter Target="TextBlock.Margin" Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                            </VisualState.Setters>
                                        </VisualState>
                                        <VisualState x:Name="IconPlaceholder">
                                            <VisualState.Setters>
                                                <Setter Target="TextBlock.Margin" Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                                <Setter Target="IconRoot.Visibility" Value="Visible" />
                                            </VisualState.Setters>
                                        </VisualState>
                                        <VisualState x:Name="CheckAndIconPlaceholder">
                                            <VisualState.Setters>
                                                <Setter Target="TextBlock.Margin" Value="{ThemeResource MenuFlyoutItemDoublePlaceholderThemeThickness}" />
                                                <Setter Target="IconRoot.Margin" Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                                <Setter Target="IconRoot.Visibility" Value="Visible" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                    <VisualStateGroup x:Name="PaddingSizeStates">
                                        <VisualState x:Name="DefaultPadding" />
                                        <VisualState x:Name="NarrowPadding">
                                            <Storyboard>
                                                <ObjectAnimationUsingKeyFrames Storyboard.TargetName="LayoutRoot" Storyboard.TargetProperty="Padding">
                                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource MenuFlyoutItemThemePaddingNarrow}" />
                                                </ObjectAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </VisualState>
                                    </VisualStateGroup>
                                    <VisualStateGroup x:Name="KeyboardAcceleratorTextVisibility">
                                        <VisualState x:Name="KeyboardAcceleratorTextCollapsed" />
                                        <VisualState x:Name="KeyboardAcceleratorTextVisible">
                                            <VisualState.Setters>
                                                <Setter Target="KeyboardAcceleratorTextBlock.Visibility" Value="Visible" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Setter Property="UseSystemFocusVisuals" Value="{StaticResource UseSystemFocusVisuals}" />
                <Setter Property="VerticalContentAlignment" Value="Center" />
            </Style>
            <Style x:Key="NotifyIconContextMenuFlyoutSubItemStyle" TargetType="MenuFlyoutSubItem">
                <Setter Property="AllowFocusOnInteraction" Value="True" />
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                <Setter Property="Padding" Value="{StaticResource MenuFlyoutItemThemePadding}" />
            </Style>
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Grid
            Grid.Row="0"
            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="0,0,0,1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <TextBlock
                Grid.Column="0"
                Margin="8"
                Style="{StaticResource BodyTextBlockStyle}"
                x:Uid="v2rayWinUI.Tray.MenuTitle"
                Text="v2rayWinUI" />
            <Button
                x:Name="MenuCloseButton"
                Grid.Column="1"
                Margin="8"
                Style="{StaticResource SubtleButtonStyle}">
                <FontIcon Glyph="&#xE711;" />
            </Button>
        </Grid>

        <StackPanel Grid.Row="1" Padding="0,2">
            <MenuFlyoutItem
                x:Name="MenuShow"
                x:Uid="v2rayWinUI.Tray.MenuShow"
                Icon="{cw:FontIcon Glyph=&#xE8A7;}"
                Command="{Binding ShowCommand}"
                Style="{ThemeResource NotifyIconContextMenuFlyoutItemStyle}"
                Text="Show" />
            <MenuFlyoutSubItem
                x:Name="MenuSystemProxy"
                x:Uid="v2rayWinUI.Tray.MenuSystemProxy"
                Icon="{cw:FontIcon Glyph=&#xE704;}"
                Style="{ThemeResource NotifyIconContextMenuFlyoutSubItemStyle}"
                Text="System Proxy">
                <MenuFlyoutItem
                    x:Name="MenuProxyClear"
                    x:Uid="v2rayWinUI.Tray.MenuProxyClear"
                    Command="{Binding ProxyChangeCommand}"
                    CommandParameter="0"
                    Text="Clear" />
                <MenuFlyoutItem
                    x:Name="MenuProxySet"
                    x:Uid="v2rayWinUI.Tray.MenuProxySet"
                    Command="{Binding ProxyChangeCommand}"
                    CommandParameter="1"
                    Text="Set" />
                <MenuFlyoutItem
                    x:Name="MenuProxyNothing"
                    x:Uid="v2rayWinUI.Tray.MenuProxyNothing"
                    Command="{Binding ProxyChangeCommand}"
                    CommandParameter="2"
                    Text="Nothing" />
                <MenuFlyoutItem
                    x:Name="MenuProxyPAC"
                    x:Uid="v2rayWinUI.Tray.MenuProxyPAC"
                    Command="{Binding ProxyChangeCommand}"
                    CommandParameter="3"
                    Text="PAC" />
            </MenuFlyoutSubItem>
            <MenuFlyoutItem
                x:Name="MenuUpdateSubs"
                x:Uid="v2rayWinUI.Tray.MenuUpdateSubs"
                Icon="{cw:FontIcon Glyph=&#xE895;}"
                Command="{Binding UpdateSubsCommand}"
                Style="{ThemeResource NotifyIconContextMenuFlyoutItemStyle}"
                Text="Update Subscriptions" />
            <MenuFlyoutItem
                x:Name="MenuExit"
                x:Uid="v2rayWinUI.Tray.MenuExit"
                Icon="{cw:FontIcon Glyph=&#xE7E8;}"
                Command="{Binding ExitCommand}"
                Style="{ThemeResource NotifyIconContextMenuFlyoutItemStyle}"
                Text="Exit" />
        </StackPanel>

        <Grid
            Grid.Row="2"
            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="0,1,0,0">
            <StackPanel
                Margin="4,0"
                HorizontalAlignment="Right"
                Orientation="Horizontal"
                Spacing="2">
                <AppBarButton
                    x:Name="MenuShowIconButton"
                    x:Uid="v2rayWinUI.Tray.MenuShowIconButton"
                    AllowFocusOnInteraction="True"
                    Command="{Binding ShowCommand}"
                    Label="Show">
                    <AppBarButton.Icon>
                        <FontIcon
                            Width="20"
                            Height="20"
                            Glyph="&#xE80F;" />
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton
                    x:Name="MenuUpdateIconButton"
                    x:Uid="v2rayWinUI.Tray.MenuUpdateIconButton"
                    AllowFocusOnInteraction="True"
                    Command="{Binding UpdateSubsCommand}"
                    Label="Update">
                    <AppBarButton.Icon>
                        <FontIcon
                            Width="20"
                            Height="20"
                            Glyph="&#xE895;" />
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton
                    x:Name="MenuExitIconButton"
                    x:Uid="v2rayWinUI.Tray.MenuExitIconButton"
                    AllowFocusOnInteraction="True"
                    Command="{Binding ExitCommand}"
                    Label="Exit">
                    <AppBarButton.Icon>
                        <FontIcon
                            Width="20"
                            Height="20"
                            Glyph="&#xE7E8;" />
                    </AppBarButton.Icon>
                </AppBarButton>
            </StackPanel>
        </Grid>
    </Grid>
</Flyout>
