<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="v2rayWinUI.Views.ProfilesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:v2rayWinUI.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Top Bar (match v2rayN layout)  -->
        <Border
            Grid.Row="0"
            Padding="8"
            Background="{ThemeResource LayerFillColorDefaultBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="0,0,0,1">
            <Grid ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Subscription groups  -->
                <StackPanel
                    Grid.Column="0"
                    Orientation="Horizontal"
                    Spacing="8">
                    <ToggleButton
                        x:Name="chipAll"
                        x:Uid="Profiles_Subscription_All"
                        Content="所有"
                        IsChecked="True" />
                    <ItemsRepeater x:Name="repSubGroups" Margin="8,0,0,0">
                        <ItemsRepeater.Layout>
                            <StackLayout Orientation="Horizontal" Spacing="8" />
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <ToggleButton Content="{Binding Remarks}" Tag="{Binding Id}" />
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </StackPanel>

                <!--  Icons group: edit/add like original  -->
                <StackPanel
                    Grid.Column="1"
                    Orientation="Horizontal"
                    Spacing="6">
                    <Button
                        x:Name="btnEditServer"
                        Style="{StaticResource DefButton}"
                        ToolTipService.ToolTip="Edit">
                        <FontIcon Glyph="&#xE70F;" />
                    </Button>
                    <Button
                        x:Name="btnAddServer"
                        Style="{StaticResource DefButton}"
                        ToolTipService.ToolTip="Add">
                        <FontIcon Glyph="&#xE710;" />
                    </Button>
                    <Button
                        x:Name="btnRemoveServer"
                        Style="{StaticResource DefButton}"
                        ToolTipService.ToolTip="Remove">
                        <FontIcon Glyph="&#xE74D;" />
                    </Button>
                </StackPanel>

                <!--  Filter  -->
                <TextBox
                    x:Name="txtServerFilter"
                    x:Uid="Profiles_Filter"
                    Grid.Column="4"
                    Width="320"
                    HorizontalAlignment="Left"
                    PlaceholderText="过滤器；按回车执行"
                    Style="{StaticResource DefTextBox}">
                    <TextBox.Resources>
                        <SolidColorBrush x:Key="TextControlBackground" Color="Transparent" />
                    </TextBox.Resources>
                </TextBox>

                <!--  Quick actions (ping/speed icons)  -->
                <StackPanel
                    Grid.Column="5"
                    Orientation="Horizontal"
                    Spacing="6">
                    <Button
                        x:Name="btnTestSpeed"
                        Style="{StaticResource DefButton}"
                        ToolTipService.ToolTip="Test">
                        <FontIcon Glyph="&#xE9F9;" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!--  Server List  -->
        <ListView
            x:Name="lstServers"
            Grid.Row="1"
            Padding="0"
            SelectionMode="Extended">

            <ListView.Header>
                <Border
                    Padding="12,8"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition Width="90" />
                            <ColumnDefinition Width="220" />
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="140" />
                            <ColumnDefinition Width="90" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Column="0"
                            FontWeight="SemiBold"
                            Text="#" />
                        <TextBlock
                            Grid.Column="1"
                            FontWeight="SemiBold"
                            Text="类型" />
                        <TextBlock
                            Grid.Column="2"
                            FontWeight="SemiBold"
                            Text="别名" />
                        <TextBlock
                            Grid.Column="3"
                            FontWeight="SemiBold"
                            Text="地址" />
                        <TextBlock
                            Grid.Column="4"
                            FontWeight="SemiBold"
                            Text="端口" />
                        <TextBlock
                            Grid.Column="5"
                            FontWeight="SemiBold"
                            Text="传输协议" />
                        <TextBlock
                            Grid.Column="6"
                            FontWeight="SemiBold"
                            Text="TLS" />
                        <TextBlock
                            Grid.Column="7"
                            FontWeight="SemiBold"
                            Text="订阅分组" />
                        <TextBlock
                            Grid.Column="8"
                            FontWeight="SemiBold"
                            Text="延迟 (ms)" />
                        <TextBlock
                            Grid.Column="9"
                            FontWeight="SemiBold"
                            Text="速度 (MB/s)" />
                        <TextBlock
                            Grid.Column="10"
                            FontWeight="SemiBold"
                            Text="今日上传" />
                        <TextBlock
                            Grid.Column="11"
                            FontWeight="SemiBold"
                            Text="今日下载" />
                        <TextBlock
                            Grid.Column="12"
                            FontWeight="SemiBold"
                            Text="总上传" />
                        <TextBlock
                            Grid.Column="13"
                            FontWeight="SemiBold"
                            Text="总下载" />
                    </Grid>
                </Border>
            </ListView.Header>

            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="12,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition Width="90" />
                            <ColumnDefinition Width="220" />
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="70" />
                            <ColumnDefinition Width="140" />
                            <ColumnDefinition Width="90" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="110" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding Sort}" />
                        <TextBlock
                            Grid.Column="1"
                            VerticalAlignment="Center"
                            Text="{Binding ConfigType}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Grid.Column="2"
                            VerticalAlignment="Center"
                            Text="{Binding Remarks}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Grid.Column="3"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding Address}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Grid.Column="4"
                            VerticalAlignment="Center"
                            Text="{Binding Port}" />
                        <TextBlock
                            Grid.Column="5"
                            VerticalAlignment="Center"
                            Text="{Binding Network}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Grid.Column="6"
                            VerticalAlignment="Center"
                            Text="{Binding StreamSecurity}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Grid.Column="7"
                            VerticalAlignment="Center"
                            Text="{Binding SubRemarks}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Grid.Column="8"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding DelayVal}" />
                        <TextBlock
                            Grid.Column="9"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding SpeedVal}" />
                        <TextBlock
                            Grid.Column="10"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding TodayUp}" />
                        <TextBlock
                            Grid.Column="11"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding TodayDown}" />
                        <TextBlock
                            Grid.Column="12"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding TotalUp}" />
                        <TextBlock
                            Grid.Column="13"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{Binding TotalDown}" />
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Padding" Value="0" />
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.ContextFlyout>
                <MenuFlyout>
                    <MenuFlyoutItem x:Name="menuEdit" Text="Edit Server">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE70F;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutItem x:Name="menuRemove" Text="Remove Server">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE74D;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutSeparator />
                    <MenuFlyoutItem x:Name="menuSetDefault" Text="Set as Active">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE73E;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutSeparator />
                    <MenuFlyoutSubItem Text="Test Speed">
                        <MenuFlyoutSubItem.Icon>
                            <FontIcon Glyph="&#xE9F9;" />
                        </MenuFlyoutSubItem.Icon>
                        <MenuFlyoutItem x:Name="menuMixedTest" Text="Mixed Test" />
                        <MenuFlyoutItem x:Name="menuTcping" Text="TCP Ping" />
                        <MenuFlyoutItem x:Name="menuRealPing" Text="Real Ping" />
                        <MenuFlyoutItem x:Name="menuSpeedTest" Text="Speed Test" />
                    </MenuFlyoutSubItem>
                    <MenuFlyoutSeparator />
                    <MenuFlyoutSubItem Text="Export">
                        <MenuFlyoutSubItem.Icon>
                            <FontIcon Glyph="&#xE74E;" />
                        </MenuFlyoutSubItem.Icon>
                        <MenuFlyoutItem x:Name="menuExportUrl" Text="Share URL" />
                        <MenuFlyoutItem x:Name="menuExportClipboard" Text="Copy to Clipboard" />
                    </MenuFlyoutSubItem>
                    <MenuFlyoutSeparator />
                    <MenuFlyoutSubItem Text="Move">
                        <MenuFlyoutSubItem.Icon>
                            <FontIcon Glyph="&#xE8DE;" />
                        </MenuFlyoutSubItem.Icon>
                        <MenuFlyoutItem x:Name="menuMoveTop" Text="Move to Top" />
                        <MenuFlyoutItem x:Name="menuMoveUp" Text="Move Up" />
                        <MenuFlyoutItem x:Name="menuMoveDown" Text="Move Down" />
                        <MenuFlyoutItem x:Name="menuMoveBottom" Text="Move to Bottom" />
                    </MenuFlyoutSubItem>
                </MenuFlyout>
            </ListView.ContextFlyout>
        </ListView>
    </Grid>
</UserControl>
